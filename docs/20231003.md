# 20231003

## ゴルーチンとループ変数の扱いに注意しない

- ゴルーチンとループ変数の扱いを誤ることは、Go開発が並行アプリケーションを書くときに犯すよくある間違いの1つ

```go
s := []int{1, 2, 3}

for _, v := range s {
  go func() {
    fmt.Println(v)
  }()
}

```

- コードの出力は決定的ではなく、ある時は233と表示され、ある時は333と表示される
- ゴルーチンを生成したときのiの値に各クロージャがアクセスするようにしたい場合、新たな変数を作成することで可能にする

```go
for _, i := range s {
    val := i
    go func() {
        fmt.Println(val)
    }()
}

```

```go
for _, v := range s {
    go func(val int) {
        fmt.Println(val)
    }(v)
}
```
