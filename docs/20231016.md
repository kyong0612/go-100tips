# 20231016

## 不正解なベンチマークを書く

```go

func BenchmarkFoo(b *testing.B) {
    for i := 0; i < b.N; i++ {
        // ここで何かをする
    }
}

```

- b.Nは可変の反復回数を表す
- ベンチマークを実行するとき、Goは要求されたベンチマーク時間と一致するように試みる
- ベンチマーク時間はデフォルトで1秒に設定されており、-benchtimeフラグで変更ができる

- マイクロベンチマークの場合、ベンチマーク実行中のマシンの動作状況・電源管理・熱スケーリング・一連の命令の優れたキャッシュアライメントなど、多くの要素が結果に影響を与える可能性がある
  - 解決法
    - -benchtimeフラグをつかってベンチマーク時間を増やすこと
    - 古典的なベンチマークツールの上に外部ツールを使うこと
      - golang.org/xリポジトリの一部であるbenchstatツールは、ベンチマーク実行に関する統計情報を計算し比較できる
